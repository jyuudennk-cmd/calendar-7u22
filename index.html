<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>予定登録</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-ZQW0KHN4MF"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}

    gtag('js', new Date());

    // ★ 明示的に page_view を送信
    gtag('config', 'G-ZQW0KHN4MF', {
      send_page_view: true
    });
  </script>
</head>

<body>
<script>
  // ===== 1. 今日 =====
  const today = new Date();

  // ===== 2. 今月の1日 =====
  const base = new Date(
    today.getFullYear(),
    today.getMonth(),
    1
  );

  // ===== 3. 7か月後の月初 =====
  const target = new Date(
    base.getFullYear(),
    base.getMonth() + 6,
    1
  );

  const y = target.getFullYear();
  const m = String(target.getMonth() + 1).padStart(2, '0');
  const d = '01';

  const startDate = `${y}${m}${d}`;

  const nextDay = new Date(target);
  nextDay.setDate(nextDay.getDate() + 1);

  const endDate =
    `${nextDay.getFullYear()}` +
    `${String(nextDay.getMonth() + 1).padStart(2, '0')}` +
    `${String(nextDay.getDate()).padStart(2, '0')}`;

  // ===== 4. iOS判定 =====
  const isIOS = /iPhone|iPad|iPod/.test(navigator.userAgent);

  // ★ GA4送信後に遷移させるため少し待つ
  setTimeout(() => {

    if (isIOS) {
      // ===== 5. iOS（ICS） =====
      const ics =
`BEGIN:VCALENDAR
VERSION:2.0
PRODID:-//QR Calendar//JP
BEGIN:VEVENT
DTSTART;VALUE=DATE:${startDate}
DTEND;VALUE=DATE:${endDate}
SUMMARY:【イオンモバイル】docomoU22学割 割引7か月目(終了月)のご連絡
DESCRIPTION:現在、割引適用開始より7か月目です。料金プランの変更の際は今月中にイオンモバイルへご相談ください。プラン変更がない場合、来月ご利用分から割引終了後の料金となります。お近くのイオンモバイルはこちら https://aeonmobile.jp/shoplist/
END:VEVENT
END:VCALENDAR`;

      const blob = new Blob([ics], { type: 'text/calendar' });
      const url = URL.createObjectURL(blob);
      location.href = url;

    } else {
      // ===== 6. Googleカレンダー =====
      const calendarUrl =
        "https://calendar.google.com/calendar/render?action=TEMPLATE" +
        "&text=【イオンモバイル】docomoU22学割 割引7か月目(終了月)のご連絡" +
        `&dates=${startDate}/${endDate}` +
        "&details=現在、割引適用開始より7か月目です。料金プランの変更の際は今月中にイオンモバイルへご相談ください。プラン変更がない場合、来月ご利用分から割引終了後の料金となります。お近くのイオンモバイルはこちら https://aeonmobile.jp/shoplist/";

      location.href = calendarUrl;
    }

  }, 800); // ★ 0.8秒待機
</script>

<p>カレンダー登録画面を開いています…</p>
</body>
</html>



